<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Books</title>
</head>

<body>
    <%- include('../partials/_navbar.ejs') %>
        <h1>Books Tracker </h1>
        <a href="/book/new">Add a new book</a>
        <% 
        const toReadBooks = Books.filter(book => book.status === 'To Read');
        const readingBooks = Books.filter(book => book.status === 'Reading');
        const finishedBooks = Books.filter(book => book.status === 'Finished');

        %>
        <h2> Currently Reading  (<%= readingBooks.length %>) </h2>
        <div>
            <% if (readingBooks.length > 0) { %>
            <ul>
                <% readingBooks.forEach((book)=> { %>
                    <li>
                        <strong> <%= book.title %></strong> owned by <%= book.owner.username %>
                        <% 
                        const total = book.totalPages
                        const current = book.currentPage
                        const percentage = (total && total > 0)
                        ? Math.round((current/ total)* 100)
                        : 0;
                        %>
                            <p>
                                <%= current %> / <%= total  %> pages | 
                                <strong> <%= percentage %>% Read </strong>
                            </p>
                            <progress value="<%= percentage %>" max="100" style="width: 250px; height: 15px;"></progress>

                            <a href="/book/<%= book._id %>"> Details</a>
                    </li>

               <% }) %>
            </ul>
            <% } else { %>
            <p>You are not currently reading any books!</p>
        <% } %>
        </div>

        
</body>

</html>